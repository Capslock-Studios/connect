<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsNext Companies</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .logo-container { display: flex; overflow-x: auto; white-space: nowrap; gap: 10px; padding: 10px; }
        .logo { width: 80px; height: 80px; cursor: pointer; border-radius: 50%; object-fit: cover; }
        .details { margin-top: 20px; padding: 10px; border: 1px solid #ccc; display: none; }
        .social-links a { margin-right: 10px; }
    </style>
</head>
<body>
    <h2>Company Logos</h2>
    <div class="logo-container" id="logoContainer"></div>
    
    <div class="details" id="companyDetails">
        <h2 id="companyName"></h2>
        <p><strong>Category:</strong> <span id="category"></span></p>
        <p><strong>Description:</strong> <span id="description"></span></p>
        <p><strong>Contact:</strong> <a id="email"></a> | <a id="phone"></a></p>
        <p><strong>Location:</strong> <span id="location"></span></p>
        <div class="social-links">
            <a id="facebook" target="_blank">Facebook</a>
            <a id="twitter" target="_blank">Twitter</a>
            <a id="instagram" target="_blank">Instagram</a>
        </div>
    </div>

    <script>
        async function fetchCompanies() {
            const response = await fetch('https://dbconn-b837.onrender.com/api/companies');
            const companies = await response.json();
            const logoContainer = document.getElementById('logoContainer');
            
            companies.forEach(company => {
                const img = document.createElement('img');
                img.src = company.logo;
                img.className = 'logo';
                img.onclick = () => displayCompanyDetails(company);
                logoContainer.appendChild(img);
            });
        }

        function displayCompanyDetails(company) {
            document.getElementById('companyName').innerText = company.name;
            document.getElementById('category').innerText = company.category;
            document.getElementById('description').innerText = company.description;
            document.getElementById('email').href = `mailto:${company.email}`;
            document.getElementById('email').innerText = company.email;
            document.getElementById('phone').href = `tel:${company.phoneNumber}`;
            document.getElementById('phone').innerText = company.phoneNumber;
            
            document.getElementById('facebook').href = company.socialMedia?.facebook || '#';
            document.getElementById('twitter').href = company.socialMedia?.twitter || '#';
            document.getElementById('instagram').href = company.socialMedia?.instagram || '#';
            
            getLocationName(company.location.latitude.$numberDouble, company.location.longitude.$numberDouble)
                .then(suburb => document.getElementById('location').innerText = suburb)
                .catch(() => document.getElementById('location').innerText = 'Unknown');
            
            document.getElementById('companyDetails').style.display = 'block';
        }

        async function getLocationName(lat, lon) {
            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
            const data = await response.json();
            return data.address.suburb || data.address.city || 'Unknown';
        }

        fetchCompanies();
    </script>
</body>
</html>
