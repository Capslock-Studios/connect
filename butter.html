<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css"/>
    <title>WhatsNext Companies</title>
</head>

<body>
 <!-- Modal -->
 <div id="addCompanyForm" class="modal">
	<div class="stable">
		<!-- Close Button -->
		<span class="close-btn" id="closeModal">&times;</span>
		<form id="companyForm" class="form">
			<label>Add your company</label>
			<!--<label><input type="text" placeholder="Name:" id="name" required></label>-->
			<br>
						<label><h3>Add your company</h3></label>
			<label><input type="text" placeholder="Name:" id="name" required></label>
			<label><input type="text" placeholder="Category:" id="categoryInput" required></label>
			<label><textarea type="text" placeholder="Description:" id="descriptionInput" required></textarea></label>
			<label><input type="email" placeholder="Email:" id="emailInput" required></label>
			<label><input type="tel" placeholder="Phone:" id="phoneInput" required></label>
			<label><input type="text" placeholder="Logo URL:" id="logoInput" required></label>
			<label><input type="text" placeholder="Latitude:" id="latitudeInput" required></label>
			<label><input type="text" placeholder="Longitude:" id="longitudeInput" required></label>
			<button class="formb" type="submit">Submit</button><br>
		</form>
	</div>
</div>

<script>
    // Close modal functionality
    document.getElementById('closeModal').addEventListener('click', function () {
        document.getElementById('addCompanyForm').classList.remove('active');
    });

    // Close modal when clicking outside of it
    window.addEventListener('click', function (e) {
        let modal = document.getElementById('addCompanyForm');
        if (e.target === modal) {
            modal.classList.remove('active');
        }
    });
</script>


			<div class="container">
			
			<div class="navbar">
				<a id="swhref" href="#internet"><button data-tooltip="Info from the internet" title="Search with Google"><i class="fab fa-google"></i></button></a>
				<a id="chref" href="#clock"><button data-tooltip="What they sell" title="Shopping Cart"><i class="fas fa-shopping-cart" ></i></button></a>
				<a id="thref" href="#timer"><button data-tooltip="What they post" title="Social Media"><i class="fas fa-users"></i></button></a>
				<a id="thref" href="#social">   <button data-tooltip="talk to them" title="Messages"><i class="fas fa-comment-alt"></i></button></a>
			</div>
		
			<div class="content-wrapper">
				<div  class="a">
					<div class="rival-boxes" id="logoContainer">
						<button  id="addCompanyBtn"><img src="/add-button.png" alt="Add"></button>
					</div>
				</div>
			<div class="stopw-section" id="internet">
				<!-- There is a bug with overlow -->
				<div class="lap-box-fixer">
				<div class="lap-box">
						<br>
						<h3>WELCOME TO</h3>
					<h1>WhatsNext</h1>
					<p>Your one-stop hub for all things entrepreneurship! We deliver the latest news, updates, and trends on the companies you care about.</p>
					<div id="posts-section">
						<h3>Recent Posts</h3>
						<div id="posts-container"></div>
					</div>
					<div class="row height d-flex justify-content-center align-items-center">
					<div class="col-md-6">
					<div class="form">
					<i class="fa fa-search"></i>
					<input type="text" class="form-control form-input" placeholder=" Search Companies...">
					<span class="left-pan"><i class="fa fa-microphone"></i></span>
  					</div>
					</div>
					</div>
					<br>
					<div class="user-card" style="border: 1px solid gray;">
						<div class="cover-photo">
							<img src="https://whatsnextgp.netlify.app/Img/1pulse%20online%20logo%20CRcL2.png" alt="Profile Picture" class="profile-photo">
						</div>
						<div class="user-info">
							<h3>Siya Percy</h3>
							<p>Software Developer at TechCorp</p>
						</div>
						<div class="buttons">
							<button>Add Friend</button>
							<button>Message</button>
						</div>
					</div>
					<div class="tiktok-card">
						<div class="video-container">
							<iframe src="https://www.youtube.com/embed/fLQwwh5sSWQ?autoplay=1&mute=1&loop=1&controls=0" allowfullscreen></iframe>
						</div><!-- Floating User Info -->
						<div class="tiktok-user-info">
							<h4>@JaneDoe</h4>
							<p>🌅 Enjoying the sunset! #Nature #Peaceful</p>
						</div>
						<!-- Floating Action Buttons -->
						<div class="floating-actions">
							<img src="https://source.unsplash.com/100x100/?portrait" alt="Profile Picture">
							<div>❤️ 1.2K</div>
							<div>💬 324</div>
							<div>↪️ 89</div>
						</div>
					</div>
					<br>
					<br>
					<br>
					<div class="post-content">
						No more posts to see
					</div>
				</div>
				</div>
			</div>
			<div class="clock-section" id="clock">
				<div class="lap-box-fixer">
				<div class="lap-box">
					<div class="sec">
					<div style="padding-top: 15px; ">
						<h1></h1>
						<h3></h3>
						<p>This is where you get news by location.</p>
						<br>
					</div>
					<div id="products-section">
						<h3>Company Products</h3>
						<div id="products-container"></div>
					</div>
					</div>
					<br><br><br>
					<div class="post-content">
						No products to see
				</div>
				</div>
			
			</div>
			
				<!-- There is a bug with overlow -->
				</div>
				
				
			
			
				<div class="timer-section" id="timer">
					<div class="lap-box-fixer">
						<div class="lap-box" style="margin-top: 130px;">
				<div class="post-card">
						<div class="post-header">
							<img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Profile Picture" class="profile-photo">
							<div class="user-info">
								<h4>John Doe</h4>
								<p>2 hrs ago · 🌍</p>
							</div>
						</div>
						<div class="post-content">
							Had an amazing time at the beach today! 🌊🌞 #Vacation #Relaxing
						</div>
						<img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Post Image" class="post-image">
						<div class="post-actions">
							<div>👍 Like</div>
							<div>💬 Comment</div>
							<div>↪️ Share</div>
						</div>
					</div>

					<div class="post-card">
						<div class="post-header">
							<img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Profile Picture" class="profile-photo">
							<div class="user-info">
								<h4>John Doe</h4>
								<p>2 hrs ago · 🌍</p>
							</div>
						</div>
						<div class="post-content">
							Had an amazing time at the beach today! 🌊🌞 #Vacation #Relaxing
						</div>
						
						<div class="pic-image-grid">
							<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT2zRDS2xh1FMc2r4cg7rY6bQaZaw7BaF4Mzg&s" alt="Large Post Image" class="pic-large-image">
							<div class="pic-small-images">
								<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJxo2NFiYcR35GzCk5T3nxA7rGlSsXvIfJwg&s" alt="Small Image 1" class="pic-small-image">
								<img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Small Image 2" class="pic-small-image">
								<div class="pic-small-image" style="position: relative;">
									<div class="pic-overlay">+1</div>
								</div>
							</div>
						</div>
						<div class="post-actions">
							<div>👍 Like</div>
							<div>💬 Comment</div>
							<div>↪️ Share</div>
						</div>
					</div>

					<div class="post-card">
					<div class="post-content">
						No more posts to see
				</div>
					</div>
<br><br><br>


					</div>
					
				</div>
				
			</div>

				 <div class="social-section" id="social">
			
					<div class="lap-box-fixer">
								
					<div class="lap-box" style="padding-top: 30px;">
					
							<style>
								.ca-contact-card {
									width: 320px;
									background: white;
									border-radius: 12px;
									box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
									text-align: center;
									padding: 20px;
								}
						
								.ca-profile-photo {
									width: 80px;
									height: 80px;
									border-radius: 50%;
									margin-bottom: 10px;
								}
						
								.ca-contact-card h2 {
									margin: 5px 0;
									font-size: 20px;
								}
						
								.ca-contact-card p {
									color: gray;
									font-size: 14px;
									margin: 5px 0 15px;
								}
						
								.ca-contact-buttons {
									display: flex;
									flex-direction: column;
									gap: 10px;
								}
						
								.ca-contact-buttons a {
									display: flex;
									align-items: center;
									justify-content: center;
									text-decoration: none;
									font-size: 14px;
									color: white;
									padding: 10px;
									border-radius: 8px;
									font-weight: bold;
								}
						
								.call { background: #28a745; } /* Green */
								.email { background: #007bff; } /* Blue */
								.whatsapp { background: #25D366; } /* WhatsApp Green */
								.socials { background: #6c757d; } /* Gray */
						
								.ca-contact-buttons a img {
									width: 18px;
									margin-right: 10px;
								}
							</style>
					
					<div class="post-card details" id="companyDetails">
						<div class="post-header">
							<img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Profile Picture" class="profile-photo">
							<div class="user-info">
								<h4 id="companyName">John Doe</h4>
								<p  id="category">2 hrs ago · 🌍</p>
							</div>
						</div>
						<div class="post-content" id="description">
							Had an amazing time at the beach today! 🌊🌞 #Vacation #Relaxing
						</div>
					
						<div class="post-actions">
							<div id="facebook" target="_blank">👍 Like</div>
							<div id="twitter" target="_blank">💬 Comment</div>
							<div id="instagram" target="_blank">↪️ Share</div>
						</div>
					</div>
					<br><br>
						<div class="post-content">
							No more posts to see
					</div>
						
					</div>

				
				</div>
				
			     </div>
			</div>
			</div>
		</div>







<script>
	document.addEventListener("DOMContentLoaded", () => {
  fetch("http://localhost:5000/api/products")
    .then(response => response.json())
    .then(data => {
      const productContainer = document.querySelector(".lap-box");
      productContainer.innerHTML = ""; // Clear previous content

      data.forEach(product => {
        const productCard = `
          <div class="card">
            <div class="card-img" style="background-image: url('${product.ProductImage}');"></div>
            <div class="card-info">
              <p class="text-title">${product.title}</p>
              <p class="text-body">${product.productDescription}</p>
            </div>
            <div class="card-footer">
              <span class="text-title">${product.ProductPrice}</span>
              <div class="card-button">
                <svg class="svg-icon" viewBox="0 0 20 20">
                  <path d="M17.72,5.011H8.026c-0.271,0-0.49,0.219-0.49,0.489c0,0.271,0.219,0.489,0.49,0.489h8.962l-1.979,4.773H6.763L4.935,5.343C4.926,5.316,4.897,5.309,4.884,5.286c-0.011-0.024,0-0.051-0.017-0.074C4.833,5.166,4.025,4.081,2.33,3.908C2.068,3.883,1.822,4.075,1.795,4.344C1.767,4.612,1.962,4.853,2.231,4.88c1.143,0.118,1.703,0.738,1.808,0.866l1.91,5.661c0.066,0.199,0.252,0.333,0.463,0.333h8.924c0.116,0,0.22-0.053,0.308-0.128c0.027-0.023,0.042-0.048,0.063-0.076c0.026-0.034,0.063-0.058,0.08-0.099l2.384-5.75c0.062-0.151,0.046-0.323-0.045-0.458C18.036,5.092,17.883,5.011,17.72,5.011z"></path>
                  <path d="M8.251,12.386c-1.023,0-1.856,0.834-1.856,1.856s0.833,1.853,1.856,1.853c1.021,0,1.853-0.83,1.853-1.853S9.273,12.386,8.251,12.386z M8.251,15.116c-0.484,0-0.877-0.393-0.877-0.874c0-0.484,0.394-0.878,0.877-0.878c0.482,0,0.875,0.394,0.875,0.878C9.126,14.724,8.733,15.116,8.251,15.116z"></path>
                  <path d="M13.972,12.386c-1.022,0-1.855,0.834-1.855,1.856s0.833,1.853,1.855,1.853s1.854-0.83,1.854-1.853S14.994,12.386,13.972,12.386z M13.972,15.116c-0.484,0-0.878-0.393-0.878-0.874c0-0.484,0.394-0.878,0.878-0.878c0.482,0,0.875,0.394,0.875,0.878C14.847,14.724,14.454,15.116,13.972,15.116z"></path>
                </svg>
              </div>
            </div>
          </div>
        `;
        productContainer.innerHTML += productCard;
      });
    })
    .catch(error => console.error("Error fetching products:", error));
});

</script>


    
<script>
	//
	//document.getElementById("addCompanyBtn").addEventListener("click", function () {
//document.getElementById("addCompanyForm").style.display = "block";
//});
        // Open Modal
        document.getElementById("addCompanyBtn").addEventListener("click", function () {
            document.getElementById("addCompanyForm").classList.add("active");
        });

        // Close Modal with Button
        document.getElementById("closeModal").addEventListener("click", function () {
            document.getElementById("addCompanyForm").classList.remove("active");
        });

        // Close Modal when Clicking Outside
        window.addEventListener("click", function (e) {
            let modal = document.getElementById("addCompanyForm");
            if (e.target === modal) {
                modal.classList.remove("active");
            }
        });
// Handle form submission
document.getElementById("companyForm").addEventListener("submit", async function (event) {
event.preventDefault();

let newCompany = {
	name: document.getElementById("name").value,
	category: document.getElementById("categoryInput").value,
	description: document.getElementById("descriptionInput").value,
	email: document.getElementById("emailInput").value,
	phoneNumber: document.getElementById("phoneInput").value,
	logo: document.getElementById("logoInput").value,
	location: {
		latitude: parseFloat(document.getElementById("latitudeInput").value),
		longitude: parseFloat(document.getElementById("longitudeInput").value)
	}
};

try {
	let response = await fetch("https://dbconn-b837.onrender.com/api/companies", {
		method: "POST",
		headers: { "Content-Type": "application/json" },
		body: JSON.stringify(newCompany)
	});

	if (!response.ok) throw new Error("Failed to add company");

	let createdCompany = await response.json();

	alert("Company added successfully!");
	document.getElementById("companyForm").reset();
	document.getElementById("addCompanyForm").style.display = "none";

	// Add new company logo dynamically
	let logoContainer = document.getElementById("logoContainer");
	let img = document.createElement("img");
	img.src = createdCompany.logo;
	img.className = "logo";
	img.onclick = () => displayCompanyDetails(createdCompany);
	logoContainer.appendChild(img);

} catch (error) {
	console.error("Error:", error);
	alert("Error adding company");
}
});
///
	// Fetch and display posts
	async function fetchPosts(companyId) {
		try {
			let response = await fetch(`https://dbconn-b837.onrender.com/api/posts?companyId=${companyId}`);
			let posts = await response.json();

			let postsContainer = document.getElementById("posts-container");
			postsContainer.innerHTML = ""; // Clear old posts

			if (posts.length === 0) {
				postsContainer.innerHTML = "<p>No posts available.</p>";
				return;
			}

			posts.forEach(post => {
				let postElement = document.createElement("div");
				postElement.classList.add("post");

				postElement.innerHTML = `
					<p><strong>${new Date(post.createdAt).toDateString()}</strong></p>
					<p>${post.content}</p>
					${post.media.length > 0 ? `<img src="${post.media[0]}" alt="Post image" width="200">` : ""}
				`;

				postsContainer.appendChild(postElement);
			});

		} catch (error) {
			console.error("Error fetching posts:", error);
		}
	}

	// Fetch and display products
	async function fetchProducts(companyId) {
		try {
			let response = await fetch(`https://dbconn-b837.onrender.com/api/products?companyId=${companyId}`);
			let products = await response.json();

			let productsContainer = document.getElementById("products-container");
			productsContainer.innerHTML = ""; // Clear old products

			if (products.length === 0) {
				productsContainer.innerHTML = "<p>No products available.</p>";
				return;
			}

			products.forEach(product => {
				let productElement = document.createElement("div");
				productElement.classList.add("product");

				productElement.innerHTML = `
				<div class="card">
<div class="card-img"><img src=""${product.ProductImage}" alt="Picture of a product"></div>
<div class="card-info">
  <p class="text-title">${product.title}</p>
  <p class="text-body">${product.productDescription}</p>
</div>
<div class="card-footer">
<span class="text-title">${product.ProductPrice}</span>
<div class="card-button">
  <svg class="svg-icon" viewBox="0 0 20 20">
	<path d="M17.72,5.011H8.026c-0.271,0-0.49,0.219-0.49,0.489c0,0.271,0.219,0.489,0.49,0.489h8.962l-1.979,4.773H6.763L4.935,5.343C4.926,5.316,4.897,5.309,4.884,5.286c-0.011-0.024,0-0.051-0.017-0.074C4.833,5.166,4.025,4.081,2.33,3.908C2.068,3.883,1.822,4.075,1.795,4.344C1.767,4.612,1.962,4.853,2.231,4.88c1.143,0.118,1.703,0.738,1.808,0.866l1.91,5.661c0.066,0.199,0.252,0.333,0.463,0.333h8.924c0.116,0,0.22-0.053,0.308-0.128c0.027-0.023,0.042-0.048,0.063-0.076c0.026-0.034,0.063-0.058,0.08-0.099l2.384-5.75c0.062-0.151,0.046-0.323-0.045-0.458C18.036,5.092,17.883,5.011,17.72,5.011z"></path>
	<path d="M8.251,12.386c-1.023,0-1.856,0.834-1.856,1.856s0.833,1.853,1.856,1.853c1.021,0,1.853-0.83,1.853-1.853S9.273,12.386,8.251,12.386z M8.251,15.116c-0.484,0-0.877-0.393-0.877-0.874c0-0.484,0.394-0.878,0.877-0.878c0.482,0,0.875,0.394,0.875,0.878C9.126,14.724,8.733,15.116,8.251,15.116z"></path>
	<path d="M13.972,12.386c-1.022,0-1.855,0.834-1.855,1.856s0.833,1.853,1.855,1.853s1.854-0.83,1.854-1.853S14.994,12.386,13.972,12.386z M13.972,15.116c-0.484,0-0.878-0.393-0.878-0.874c0-0.484,0.394-0.878,0.878-0.878c0.482,0,0.875,0.394,0.875,0.878C14.847,14.724,14.454,15.116,13.972,15.116z"></path>
  </svg>
</div>
</div>
</div>
				`;

				productsContainer.appendChild(productElement);
			});

		} catch (error) {
			console.error("Error fetching products:", error);
		}
	}

	// Fetch and display companies
	async function fetchCompanies() {
		const response = await fetch('https://dbconn-b837.onrender.com/api/companies');
		const companies = await response.json();
		const logoContainer = document.getElementById('logoContainer');
		
		companies.forEach(company => {
			const img = document.createElement('img');
			img.src = company.logo;
			img.className = 'logo';
			img.onclick = () => displayCompanyDetails(company);
			logoContainer.appendChild(img);
		});
	}

	function displayCompanyDetails(company) {
		document.getElementById('companyName').innerText = company.name;
		document.getElementById('category').innerText = company.category;
		document.getElementById('description').innerText = company.description;
		document.getElementById('email').href = `mailto:${company.email}`;
		document.getElementById('email').innerText = company.email;
		document.getElementById('phone').href = `tel:${company.phoneNumber}`;
		document.getElementById('phone').innerText = company.phoneNumber;
		
		document.getElementById('facebook').href = company.socialMedia?.facebook || '#';
		document.getElementById('twitter').href = company.socialMedia?.twitter || '#';
		document.getElementById('instagram').href = company.socialMedia?.instagram || '#';
		
		getLocationName(company.location.latitude.$numberDouble, company.location.longitude.$numberDouble)
			.then(suburb => document.getElementById('location').innerText = suburb)
			.catch(() => document.getElementById('location').innerText = 'Unknown');
		
		document.getElementById('companyDetails').style.display = 'block';

		// Fetch posts and products for this company
		fetchPosts(company._id);
		fetchProducts(company._id);
	}

	async function getLocationName(lat, lon) {
		const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
		const data = await response.json();
		return data.address.suburb || data.address.city || 'Unknown';
	}

	fetchCompanies();
</script>
<script src="script.js" type="text/javascript" charset="utf-8"></script>
	</body>
	</html>

