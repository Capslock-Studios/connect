<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>WhatsNext Companies</title>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <div class="container">
        
        <div class="content-wrapper">
            <div class="company-logos">
                <div class="rival-boxes" id="logoContainer">
                    <button id="addCompanyBtn"><img src="/add-button.png" alt="Add Company"></button>
                </div>
            </div>
            
            <!-- Internet Section -->
            <div class="section" id="internet">
                <div class="section-content">
                    <h3>WELCOME TO</h3>
                    <h1>WhatsNext</h1>
                    <p>Your one-stop hub for all things entrepreneurship! We deliver the latest news, updates, and trends on the companies you care about.</p>
                    
                    <div class="search-container">
                        <div class="search-box">
                            <i class="fa fa-search"></i>
                            <input type="text" class="search-input" placeholder="Search Companies...">
                            <span class="search-icon"><i class="fa fa-microphone"></i></span>
                        </div>
                    </div>
                    
                    <div id="posts-section">
                        <h3>Recent Posts</h3>
                        <div id="posts-container" class="posts-grid"></div>
                    </div>
                    
                    <div class="user-card">
                        <div class="cover-photo">
                            <img src="https://whatsnextgp.netlify.app/Img/1pulse%20online%20logo%20CRcL2.png" alt="Profile Picture" class="profile-photo">
                        </div>
                        <div class="user-info">
                            <h3>Siya Percy</h3>
                            <p>Software Developer at TechCorp</p>
                        </div>
                        <div class="buttons">
                            <button class="btn-primary">Add Friend</button>
                            <button class="btn-secondary">Message</button>
                        </div>
                    </div>
                    
                    <div class="tiktok-card">
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/fLQwwh5sSWQ?autoplay=1&mute=1&loop=1&controls=0" allowfullscreen></iframe>
                        </div>
                        <div class="tiktok-user-info">
                            <h4>@JaneDoe</h4>
                            <p>üåÖ Enjoying the sunset! #Nature #Peaceful</p>
                        </div>
                        <div class="floating-actions">
                            <img src="https://source.unsplash.com/100x100/?portrait" alt="Profile Picture">
                            <div>‚ù§Ô∏è 1.2K</div>
                            <div>üí¨ 324</div>
                            <div>‚Ü™Ô∏è 89</div>
                        </div>
                    </div>
                    
                    <div class="no-content">
                        No more posts to see
                    </div>
                </div>
            </div>
            
            <!-- Products Section -->
            <div class="section" id="clock">
                <div class="section-content">
                    <h2>Company Products</h2>
                    <p>Browse products from our featured companies</p>
                    <div id="products-container" class="products-grid"></div>
                    <div class="no-content">
                        No products to see
                    </div>
                </div>
            </div>
            
            <!-- Social Posts Section -->
            <div class="section" id="timer">
                <div class="section-content">
                    <div class="post-card">
                        <div class="post-header">
                            <img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Profile Picture" class="profile-photo">
                            <div class="user-info">
                                <h4>John Doe</h4>
                                <p>2 hrs ago ¬∑ üåç</p>
                            </div>
                        </div>
                        <div class="post-content">
                            Had an amazing time at the beach today! üåäüåû #Vacation #Relaxing
                        </div>
                        <img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Post Image" class="post-image">
                        <div class="post-actions">
                            <button>üëç Like</button>
                            <button>üí¨ Comment</button>
                            <button>‚Ü™Ô∏è Share</button>
                        </div>
                    </div>
                    
                    <div class="post-card">
                        <div class="post-header">
                            <img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Profile Picture" class="profile-photo">
                            <div class="user-info">
                                <h4>John Doe</h4>
                                <p>2 hrs ago ¬∑ üåç</p>
                            </div>
                        </div>
                        <div class="post-content">
                            Had an amazing time at the beach today! üåäüåû #Vacation #Relaxing
                        </div>
                        <div class="image-grid">
                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT2zRDS2xh1FMc2r4cg7rY6bQaZaw7BaF4Mzg&s" alt="Large Post Image" class="main-image">
                            <div class="thumbnail-container">
                                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJxo2NFiYcR35GzCk5T3nxA7rGlSsXvIfJwg&s" alt="Small Image">
                                <img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Small Image">
                                <div class="more-images">+1</div>
                            </div>
                        </div>
                        <div class="post-actions">
                            <button>üëç Like</button>
                            <button>üí¨ Comment</button>
                            <button>‚Ü™Ô∏è Share</button>
                        </div>
                    </div>
                    
                    <div class="no-content">
                        No more posts to see
                    </div>
                </div>
            </div>
            
            <!-- Contact Section -->
            <div class="section" id="social">
                <div class="section-content">
                    <div class="company-details" id="companyDetails">
                        <div class="company-header">
                            <img src="https://cdn.prod.website-files.com/62d84e447b4f9e7263d31e94/6399a4d27711a5ad2c9bf5cd_ben-sweet-2LowviVHZ-E-unsplash-1.jpeg" alt="Company Logo" class="company-logo">
                            <div class="company-info">
                                <h3 id="companyName">Company Name</h3>
                                <p id="category">Category</p>
                            </div>
                        </div>
                        <div class="company-description" id="description">
                            Company description goes here.
                        </div>
                        <div class="contact-actions">
                            <a href="#" id="facebook" class="social-btn"><i class="fab fa-facebook"></i> Facebook</a>
                            <a href="#" id="twitter" class="social-btn"><i class="fab fa-twitter"></i> Twitter</a>
                            <a href="#" id="instagram" class="social-btn"><i class="fab fa-instagram"></i> Instagram</a>
                        </div>
                        <div class="contact-info">
                            <a href="#" id="email"><i class="fas fa-envelope"></i> Email</a>
                            <a href="#" id="phone"><i class="fas fa-phone"></i> Phone</a>
                            <a href="#" id="location"><i class="fas fa-map-marker-alt"></i> Location</a>
                        </div>
                    </div>
                    
                    <div class="no-content">
                        No more information to display
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const addCompanyBtn = document.getElementById('addCompanyBtn');
        const closeModalBtn = document.getElementById('closeModal');
        const modal = document.getElementById('addCompanyForm');
        const companyForm = document.getElementById('companyForm');

        // Event Listeners
        addCompanyBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        window.addEventListener('click', outsideClick);
        companyForm.addEventListener('submit', handleFormSubmit);

        // Modal Functions
        function openModal() {
            modal.classList.add('active');
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        function outsideClick(e) {
            if (e.target === modal) {
                closeModal();
            }
        }

        // Form Submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const newCompany = {
                name: document.getElementById('name').value,
                category: document.getElementById('categoryInput').value,
                description: document.getElementById('descriptionInput').value,
                email: document.getElementById('emailInput').value,
                phoneNumber: document.getElementById('phoneInput').value,
                logo: document.getElementById('logoInput').value,
                location: {
                    latitude: parseFloat(document.getElementById('latitudeInput').value),
                    longitude: parseFloat(document.getElementById('longitudeInput').value)
                }
            };

            try {
                const response = await fetch('https://dbconn-b837.onrender.com/api/companies', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newCompany)
                });

                if (!response.ok) throw new Error('Failed to add company');

                const createdCompany = await response.json();
                alert('Company added successfully!');
                companyForm.reset();
                closeModal();
                addCompanyLogo(createdCompany);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error adding company');
            }
        }

        function addCompanyLogo(company) {
            const logoContainer = document.getElementById('logoContainer');
            const img = document.createElement('img');
            img.src = company.logo;
            img.className = 'company-logo';
            img.alt = company.name;
            img.onclick = () => displayCompanyDetails(company);
            logoContainer.insertBefore(img, addCompanyBtn);
        }

        // Fetch and display functions
        async function fetchCompanies() {
            try {
                const response = await fetch('https://dbconn-b837.onrender.com/api/companies');
                const companies = await response.json();
                const logoContainer = document.getElementById('logoContainer');
                
                companies.forEach(company => {
                    const img = document.createElement('img');
                    img.src = company.logo;
                    img.className = 'company-logo';
                    img.alt = company.name;
                    img.onclick = () => displayCompanyDetails(company);
                    logoContainer.appendChild(img);
                });
            } catch (error) {
                console.error('Error fetching companies:', error);
            }
        }

        async function fetchPosts(companyId) {
            try {
                const response = await fetch(`https://dbconn-b837.onrender.com/api/posts?companyId=${companyId}`);
                const posts = await response.json();
                const postsContainer = document.getElementById('posts-container');
                
                postsContainer.innerHTML = posts.length === 0 
                    ? '<p>No posts available.</p>'
                    : posts.map(post => `
                        <div class="post">
                            <p class="post-date"><strong>${new Date(post.createdAt).toDateString()}</strong></p>
                            <p class="post-content">${post.content}</p>
                            ${post.media.length > 0 ? `<img src="${post.media[0]}" alt="Post image" class="post-image">` : ''}
                        </div>
                    `).join('');
            } catch (error) {
                console.error('Error fetching posts:', error);
            }
        }

        async function fetchProducts(companyId) {
            try {
                const response = await fetch(`https://dbconn-b837.onrender.com/api/products?companyId=${companyId}`);
                const products = await response.json();
                const productsContainer = document.getElementById('products-container');
                
                productsContainer.innerHTML = products.length === 0
                    ? '<p>No products available.</p>'
                    : products.map(product => `
                        <div class="product-card">
                            <div class="product-image">
                                <img src="${product.ProductImage}" alt="${product.title}">
                            </div>
                            <div class="product-info">
                                <h4>${product.title}</h4>
                                <p>${product.productDescription}</p>
                                <div class="product-footer">
                                    <span class="price">${product.ProductPrice}</span>
                                    <button class="add-to-cart">
                                        <i class="fas fa-shopping-cart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        function displayCompanyDetails(company) {
            document.getElementById('companyName').textContent = company.name;
            document.getElementById('category').textContent = company.category;
            document.getElementById('description').textContent = company.description;
            
            const emailLink = document.getElementById('email');
            emailLink.href = `mailto:${company.email}`;
            emailLink.innerHTML = `<i class="fas fa-envelope"></i> ${company.email}`;
            
            const phoneLink = document.getElementById('phone');
            phoneLink.href = `tel:${company.phoneNumber}`;
            phoneLink.innerHTML = `<i class="fas fa-phone"></i> ${company.phoneNumber}`;
            
            document.getElementById('facebook').href = company.socialMedia?.facebook || '#';
            document.getElementById('twitter').href = company.socialMedia?.twitter || '#';
            document.getElementById('instagram').href = company.socialMedia?.instagram || '#';
            
            getLocationName(company.location.latitude, company.location.longitude)
                .then(location => {
                    document.getElementById('location').innerHTML = `<i class="fas fa-map-marker-alt"></i> ${location}`;
                })
                .catch(() => {
                    document.getElementById('location').innerHTML = '<i class="fas fa-map-marker-alt"></i> Unknown';
                });

            fetchPosts(company._id);
            fetchProducts(company._id);
            
            // Scroll to details section
            document.getElementById('social').scrollIntoView({ behavior: 'smooth' });
        }

        async function getLocationName(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                return data.address.suburb || data.address.city || 'Unknown location';
            } catch (error) {
                console.error('Error fetching location:', error);
                return 'Unknown location';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', fetchCompanies);
    </script>
</body>
</html>